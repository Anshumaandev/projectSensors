import csv

def WestimatePosition(inputArray):
    prevVelocityVal = 0
    prevPosVal = 0
    pprevPosVal = 0
    prevTs = 0
    pprevTs = -1
    prevAccelVal = 0
    deltaResistance = 0.03  # Adjust this value according to your requirements

    data = []

    for i in range(len(inputArray)):
        accelValStr, _, timeStr = inputArray[i].split(",")
        accelVal = float(accelValStr)
        time = float(timeStr)

        if time == prevTs or time == pprevTs:
            data.append([prevPosVal, accelVal])
        elif prevTs == 0:
            prevTs = time
            data.append([prevPosVal, accelVal])
        else:
            dT = time - prevTs
            pdT = prevTs - pprevTs
            print(f"HEREEEE {prevVelocityVal}, {accelVal}, {prevAccelVal}, {dT}")
            AveragingAccelValues = 0.5 * (accelVal + prevAccelVal) * dT
            # MultiplyingAvgValuestodT = AveragingAccelValues 
            vel = prevVelocityVal + AveragingAccelValues
            # vel = (prevVelocityVal + (0.5 * (accelVal + prevAccelVal) * dT))
            pos = prevPosVal + ((1 - deltaResistance) * (prevPosVal - pprevPosVal) * (dT / pdT)) + accelVal * dT * dT
            print(f"VELOCITYY---- {vel}")
            data.append([pos, accelVal, vel, prevVelocityVal, prevAccelVal, dT])
            prevPosVal = pos
            pprevPosVal = prevPosVal
            pprevTs = prevTs
            prevTs = time
            prevVelocityVal = vel
            prevAccelVal = accelVal

    return data


# Example usage:
input_data = ['0.0,,598.520946187', '0.0314394,,598.530980726', '0.021538854,,598.540962726', '-0.09774885,,598.551065649', '-0.31229442,,598.560981034', '-0.7427365,,598.570956495', '-1.3001325,,598.580959341', '-2.0862193,,598.590959034', '-2.779835,,598.601013418', '-3.2196686,,598.611498187', '-3.5133502,,598.62115888', '-3.6675534,,598.630957264', '-3.7735047,,598.640924957', '-3.8971653,,598.650947034', '-4.0287495,,598.660952957', '-4.144742,,598.670943111', '-4.189292,,598.680962264', '-4.0168824,,598.690943495', '-3.6528978,,598.700928572', '-2.9633508,,598.710942418', '-2.3086624,,598.720938187', '-1.9016948,,598.732407803', '-1.7666035,,598.743760495', '-1.7927549,,598.751416726', '-1.8247154,,598.760993572', '-2.0004725,,598.771338264', '-2.4016147,,598.782065264', '-2.8656793,,598.790941341', '-3.1871197,,598.800946803', '-3.058097,,598.810941803', '-2.0506868,,598.820942957', '0.8278884,,598.83095688', '4.3501306,,598.840948264', '7.7425947,,598.850953495', '10.73649,,598.860941803', '13.136201,,598.870952803', '14.318396,,598.880941418', '13.021997,,598.890951341', '10.811684,,598.90094888', '8.608614,,598.910966957', '6.895668,,598.920951803', '5.770864,,598.930948341', '4.877887,,598.940943188', '3.8960304,,598.950947649', '2.784027,,598.960943495', '1.4773479,,598.971699418', '0.17642891,,598.980949418', '-0.8740674,,598.990945495', '-1.5948709,,599.001142572', '-2.1838512,,599.010950418', '-2.82698,,599.020945572', '-3.5018187,,599.03097088', '-4.1230273,,599.04095688', '-4.6709476,,599.050952111', '-5.1222477,,599.06094388', '-5.4532976,,599.07101888', '-5.8954473,,599.082540341', '-6.1950016,,599.090952034', '-6.556498,,599.101569341', '-6.913596,,599.110956803', '-7.0105686,,599.121035111', '-7.0952864,,599.130948649', '-6.9575353,,599.140948418', '-6.283248,,599.150949264', '-5.0898113,,599.160995649', '-3.9232507,,599.170961111', '-3.0994349,,599.180987188', '-2.480825,,599.190954341', '-2.031024,,599.200980649', '-1.3699367,,599.210965341', '0.027926952,,599.22161088', '2.0122526,,599.231086264', '4.203677,,599.240953957', '7.0809784,,599.250940188', '9.278157,,599.260955341', '9.767742,,599.271950111', '9.390814,,599.281119649', '8.580535,,599.290947264', '7.8249564,,599.300941111', '7.2425065,,599.312468418', '6.687234,,599.320949957', '5.91827,,599.330949111', '5.011384,,599.340942341', '4.013996,,599.350946111', '2.9722848,,599.360947649', '1.8136195,,599.371964957', '0.6337311,,599.380945803', '-0.59772134,,599.390950726', '-1.7708039,,599.40095188', '-3.0135741,,599.410955418', '-4.2942877,,599.420955495', '-5.3272047,,599.430956188', '-6.018348,,599.440950649', '-6.1307526,,599.450956264', '-5.6334367,,599.460968264', '-4.366864,,599.470947264', '-3.1918328,,599.480941034', '-2.8429565,,599.490950649', '-3.156897,,599.501208726', '-3.6066105,,599.51094188', '-3.8023465,,599.520945957', '-4.039736,,599.530936341', '-4.3675776,,599.540942957', '-4.683528,,599.550950418', '-4.7422724,,599.561032034', '-4.3947334,,599.570950495', '-3.9338071,,599.580945188', '-3.4294033,,599.59095288', '-2.882289,,599.60095788', '-2.1268983,,599.610958418', '-0.79709274,,599.621394649', '0.8513613,,599.63094988', '3.0852594,,599.640944649', '5.460289,,599.650950188', '7.4971485,,599.660944341', '8.797836,,599.670953495', '8.742699,,599.680949034', '8.002075,,599.690955572', '7.0242124,,599.700962418', '6.230294,,599.710958649', '5.614431,,599.720950957', '5.1123,,599.730946803', '4.694477,,599.740953957', '4.356906,,599.750953957', '4.1292534,,599.761326034', '3.8046994,,599.770949957', '3.05903,,599.780960572', '1.9913311,,599.790961418', '0.65412956,,599.800931418', '-0.63124007,,599.810958034', '-1.706518,,599.820965803', '-2.5800157,,599.830990418', '-3.1868014,,599.840936649', '-3.6859756,,599.850948957', '-4.2318015,,599.860935649', '-4.770012,,599.872546264', '-5.2568274,,599.880950495', '-5.7000494,,599.890950188', '-6.147608,,599.90095188', '-6.6061935,,599.910945572', '-6.907625,,599.92094088', '-6.997918,,599.930944572', '-6.597509,,599.940942111', '-5.719263,,599.950944649', '-4.383182,,599.960949111', '-3.2551706,,599.970950726', '-2.6118798,,599.980952572', '-2.2124581,,599.990954111', '-1.8199229,,600.000949957', '-1.2606943,,600.011031572', '-0.21005875,,600.020956957', '1.3437996,,600.031420572', '3.3198972,,600.041341649', '5.104301,,600.05095188', '6.2395306,,600.060956572', '6.790571,,600.070948418', '6.6401205,,600.080947034', '6.3575115,,600.090954957', '6.2181206,,600.100956111', '6.1024685,,600.110955495', '5.864484,,600.120957034', '5.605471,,600.130946034', '5.3147035,,600.140951957', '4.8536453,,600.150954495', '4.196578,,600.160949418', '3.500844,,600.170952495', '2.6555166,,600.18095088', '1.6789706,,600.190949957', '0.51522785,,600.200956034', '-0.6447282,,600.210944957', '-1.7943314,,600.220955572', '-2.8350787,,600.230953034', '-3.597472,,600.240949265', '-4.203517,,600.250948265', '-4.7078447,,600.260949495', '-4.9998846,,600.270950188', '-4.999613,,600.280964572', '-4.9483547,,600.290945957', '-4.9075336,,600.300979803', '-4.8764877,,600.310947341', '-4.805296,,600.322187341', '-4.724033,,600.330951572', '-4.669822,,600.340949957', '-4.6599855,,600.350940495', '-4.739935,,600.361295803', '-4.9290695,,600.370942341', '-5.0793786,,600.38094188', '-4.88164,,600.390949341', '-4.1166883,,600.400947495', '-2.8665452,,600.410945803', '-0.6635062,,600.422830188', '1.9060509,,600.43094388', '4.7815547,,600.440936418', '7.4573407,,600.451001572', '9.165594,,600.460932649', '9.989498,,600.470937111', '9.867844,,600.480955649', '9.334917,,600.491044572', '8.447805,,600.500939726', '7.4772716,,600.510981495', '6.423689,,600.520942572', '5.2696896,,600.533454188', '4.3020477,,600.54095188', '3.4980023,,600.55095088', '2.51368,,600.563248572', '1.5539153,,600.570940803', '0.62964094,,600.580947188', '-0.4205192,,600.590967495', '-1.6364529,,600.600977341', '-2.723781,,600.610961726', '-3.5172472,,600.620977957', '-4.0799875,,600.630941957', '-4.368795,,600.640944418', '-4.5973415,,600.650946649', '-4.768338,,600.660951111', '-4.8815312,,600.670945265', '-4.994952,,600.680941649', '-5.1563396,,600.690942649', '-5.414472,,600.700945726', '-5.627343,,600.710956034', '-5.577895,,600.720969188', '-5.295598,,600.730948111', '-4.8265324,,600.740977188', '-4.3303432,,600.750952572', '-4.020341,,600.760967341', '-3.8364716,,600.770955803', '-3.587016,,600.78095588', '-2.9754245,,600.790955803', '-1.1800694,,600.800954034', '1.4023669,,600.810960265', '4.692269,,600.821084726', '7.7987595,,600.830949265', '9.965193,,600.841740111', '11.070307,,600.851007803', '10.669481,,600.860941341', '9.667488,,600.871075726', '8.238633,,600.88094788', '6.6972165,,600.890954726', '4.958855,,600.90093988', '3.2833734,,600.910952265', '1.9203625,,600.920954803', '0.7787644,,600.930953495', '-0.1957479,,600.940951418', '-1.0098683,,600.950955957', '-1.5627298,,600.960954803', '-1.9371084,,600.970957034', '-2.2583122,,600.980953418', '-2.6799343,,600.990953726', '-3.1071377,,601.000927957', '-3.5360603,,601.010945034', '-3.9983013,,601.020930726', '-4.3937316,,601.030937418', '-4.7281256,,601.04092988', '-5.1013136,,601.050935649', '-5.510486,,601.060928111', '-5.853426,,601.070935957', '-6.1136155,,601.080925418', '-6.3916245,,601.090932188', '-6.6638384,,601.100944649', '-6.924456,,601.112837265', '-6.753113,,601.120949188', '-5.9241877,,601.130946418', '-4.304705,,601.140947803', '-2.3382897,,601.150953572', '0.19299191,,601.160958188', '3.0315492,,601.170961265', '6.316217,,601.181299188', '9.705429,,601.191048188', '12.652052,,601.200942111', '14.600723,,601.210972726', '14.647526,,601.220943572', '13.423759,,601.23093688', '10.597076,,601.240941726', '7.3891125,,601.250949034', '4.5543246,,601.26094388', '2.3448572,,601.270947341', '0.8777505,,601.280947265', '-0.28468513,,601.290949495', '-1.231049,,601.300948726', '-2.0959024,,601.310952111', '-3.1471856,,601.320942111', '-4.337903,,601.330947957', '-5.3850727,,601.341163572', '-6.2205544,,601.350956111', '-6.8567476,,601.360947726', '-7.270359,,601.370960649', '-7.0700016,,601.380943342', '-6.319296,,601.390951726', '-5.1710253,,601.400953342', '-4.248437,,601.411079649', '-3.9463258,,601.420943495', '-4.0496664,,601.430950649', '-4.369293,,601.440945649', '-4.634103,,601.450946495', '-4.5413604,,601.460948034', '-3.9381475,,601.470954957', '-2.4606097,,601.480942111', '-0.6356828,,601.490948188', '1.5968546,,601.501110265', '4.6018295,,601.511040957', '7.158347,,601.521211418', '9.457628,,601.530981418', '11.2071705,,601.540948418', '11.674238,,601.550945342', '11.352442,,601.560946649', '10.360135,,601.570943495', '8.597027,,601.580947188', '6.540739,,601.590942188', '4.419898,,601.600944111', '2.462789,,601.610945111', '0.24904037,,601.62351288', '-1.752193,,601.631179418', '-2.747981,,601.64095488', '-3.7327292,,601.650953034', '-4.4955597,,601.660950342', '-5.177438,,601.670948495', '-6.1689987,,601.684181495', '-6.669392,,601.690951034', '-6.638735,,601.700964188', '-6.735237,,601.710939649', '-6.728348,,601.720946342', '-6.619032,,601.731206572', '-6.4644413,,601.740954803', '-6.050819,,601.752047572', '-5.4414883,,601.760956803', '-4.677284,,601.770968649', '-3.894072,,601.780961111', '-3.1135778,,601.790966726', '-2.2530527,,601.80092788', '-0.788869,,601.810963803', '1.0557626,,601.820966418', '3.347455,,601.830963265', '5.7713957,,601.840966803', '7.8784657,,601.850966649', '9.517596,,601.860956111', '10.265045,,601.87101688', '10.227509,,601.880935957', '9.176933,,601.890945034', '7.6833878,,601.900944726', '5.995379,,601.910955803', '3.8798232,,601.928073803', '2.459712,,601.930969188', '1.7642083,,601.940976188', '0.6680407,,601.950966111', '-0.4668306,,601.961137726', '-1.615241,,601.970940265', '-2.702969,,601.980944265', '-3.6611347,,601.991117265', '-4.3361373,,602.001002418', '-4.7109985,,602.012741188', '-4.9409523,,602.020951111', '-4.9073176,,602.030936418', '-4.7528567,,602.040945188', '-4.355749,,602.050949649', '-3.8789797,,602.060948418', '-3.2866402,,602.070943265', '-2.6386914,,602.08095388', '-2.2040215,,602.090953188', '-1.8110325,,602.100945265', '-1.1573474,,602.110947342', '-0.34667853,,602.120952188', '0.4059643,,602.130953803', '0.9417242,,602.140953649', '1.3390878,,602.151057111']

data = WestimatePosition(input_data)

with open('outputpy.csv', 'w', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(["position", "accelValues", "Velocity", "prevVelocityVal", "prevAccelVal", "dT"])
    writer.writerows(data)